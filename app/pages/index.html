<!DOCTYPE html>
<html lang="en">
<head>
    <body>
        <h4>Yo dawg, what up?</h4>
        <h1>[01]</h1>
    </body>

    <script type="text/javascript">
        (function() {

            function loadJSON(fileName, callback) {
                var xobj = new XMLHttpRequest();
                xobj.overrideMimeType("application/json");
                xobj.open('GET', fileName, true);
                // Replace 'my_data' with the path to your file
                xobj.onreadystatechange = function() {
                    if (xobj.readyState === 4 && xobj.status === 200) {
                        // Required use of an anonymous callback 
                        // as .open() will NOT return a value but simply 
                        // returns undefined in asynchronous mode
                        callback(xobj.responseText);
                    }
                };
                xobj.send(null);
            }

            var loadFile = (() => {
                var loader = (fileName, callback, type, varName) => {

                    var fileRequest;
                    var fileType = type || 'js';

                    if (fileType === 'json' && varName) {
                        loadJSON(fileName, function(response) {
                            // Parse JSON string into object
                            window[varName] = JSON.parse(response);
                            console.log(varName, window[varName]);
                            if (callback) { callback(); }
                        });
                    } else if (fileType === 'js') {
                        fileRequest = document.createElement('script');
                        fileRequest.setAttribute('type', "text/javascript");
                        fileRequest.setAttribute('src', fileName);
                        fileRequest.setAttribute('async', true);
                        if (callback) {
                            fileRequest.onload = callback;
                        }
                    } else if (fileType === 'css') {
                        fileRequest = document.createElement('link');
                        fileRequest.setAttribute('rel', 'stylesheet');
                        fileRequest.setAttribute('type', 'text/css');
                        fileRequest.setAttribute('href', fileName);
                    }

                    if (fileRequest) {
                        document.getElementsByTagName("head")[0].appendChild(fileRequest);
                    }
                };

                return loader;
            })();

            var loadApp = (() =>{

                var phase01 = () => {
                    loadFile('/app.js');
                    loadFile('albumMeta.json', phase02, json, 'GALLERY');
                };

                var phase02 = () => {
                    loadFile('/site-nav.json', null, 'json', 'NAV');;
                    loadFile('/style.css', null, 'css');
                    loadFile('/nav.js', phase03);
                };

                var phase03 = () => {
                    if (ENV == 'DEV') {
                        loadFile('/editor.js');
                    }
                };

                return () => {
                    console.log('window.location', window.location);
                    // phase01();
                };
            })();

            document.onload(loadApp);

        })();
    </script>

</html>

